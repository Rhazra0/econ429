collap(~nhgist+year,fsum),by=c("nhgist","year")) %>%
mutate(ncountyseatnew=ifelse(is.na(ncountyseatnew),0,ncountyseatnew),
yeardec=round(year/10),countylawyeardec=round(countylawyear/10)) %>%
collap(~nhgist+yeardec+countylawyeardec,fsum),
yname = "ncountyseatnew", idname = "statename", tname = "yeardec", gname = "countylawyeardec", estimator = c("sunab"))%>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,14,1),minor_breaks=NULL)+theme_minimal() +
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since Law Restricting County Formation Passed", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofstatelaws_eventstudy_sunab_FEyearstate_ncountyseatnew.png"),
height=8, width=10)
event_study(data = uscountydiv_analysis_panel %>% filter(datayear==boundyear) %>% select(statename,datayear,countylawyear) %>% mutate(ncounty=1) %>%
collap(~statename+datayear+countylawyear,fsum) %>%
mutate(ncountynew = ncounty-L(ncounty,1,statename,datayear),
countylawyeardec=round(countylawyear/10),datayeardec=round(datayear/10)) ,
yname = "ncountynew", idname = "statename", tname = "datayeardec", gname = "countylawyeardec", estimator = c("sunab"))%>%
plot_event_study()
(event_study(data = uscountydiv_analysis_panel %>% filter(datayear==boundyear) %>% select(statename,datayear,countylawyear) %>% mutate(ncounty=1) %>%
collap(~statename+datayear+countylawyear,fsum) %>%
mutate(ncountynew = ncounty-L(ncounty,1,statename,datayear),
countylawyeardec=round(countylawyear/10),datayeardec=round(datayear/10)) ,
yname = "ncountynew", idname = "statename", tname = "datayeardec", gname = "countylawyeardec", estimator = c("sunab"))%>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,14,1),minor_breaks=NULL)+theme_minimal() +
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since Law Restricting County Formation Passed", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofstatelaws_eventstudy_sunab_FEyearstate_ncountynew.png"),
height=8, width=10)
(event_study(data = statelaws_countyformation %>% tibble() %>% select(statename,nhgist=gisjoin,countylawyear) %>% expand_grid(year=seq(1790,1950,1)) %>%
left_join(countyseatextant %>% mutate(nhgist=str_sub(gisjoin,1,4)) %>% tibble() %>% select(nhgist,year=cntycreatyear) %>% mutate(ncountyseatnew=1) %>%
collap(~nhgist+year,fsum),by=c("nhgist","year")) %>%
mutate(ncountyseatnew=ifelse(is.na(ncountyseatnew),0,ncountyseatnew),
yeardec=round(year/10),countylawyeardec=round(countylawyear/10)) %>%
collap(~nhgist+yeardec+countylawyeardec,fsum),
yname = "ncountyseatnew", idname = "statename", tname = "yeardec", gname = "countylawyeardec", estimator = c("sunab"))%>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,14,1),minor_breaks=NULL)+theme_minimal() +
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since Law Restricting County Formation Passed", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofstatelaws_eventstudy_sunab_FEyearstate_ncountyseatnew.png"),
height=8, width=10)
a <- uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1870,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900) |
(boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |  (boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10)))
ysnc <- paste0("ysncdecfyrdsplitabove5perc")
a <- uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1870,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900) |
(boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |  (boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10)))
a <- uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1940,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900) |
(boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |  (boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10)))
a2 <- uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1870,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10)))
############################################################################################################################################
##### Event study specification of the effects of splitting
for (dep in c("dfrac_bplntst","dfrac_bplnt","dfrac_bplst","frac_bplntst","frac_bplnt","frac_bplst",
"p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
"nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
#for (dep in c("p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
#              "nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
for (thr in c(50,75)) {
for (byr in c(1840,1850,1860,1870,1880)) {
ysnc <- paste0("ysncdecfyrdsplitabove",thr,"perc")
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear==byr & datayear>=byr & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab")) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear",byr,"_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1940,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900) |
(boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |  (boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1940_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
}
for (dep in c("dfrac_bplntst","dfrac_bplnt","dfrac_bplst","frac_bplntst","frac_bplnt","frac_bplst",
"p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
"nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
#for (dep in c("p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
#              "nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
for (thr in c(50,75)) {
for (byr in c(1840,1850,1860,1870,1880)) {
ysnc <- paste0("ysncdecfyrdsplitabove",thr,"perc")
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear==byr & datayear>=byr & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab")) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear",byr,"_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1940,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900) |
(boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |  (boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1940_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
}
for (dep in c("dfrac_bplntst","dfrac_bplnt","dfrac_bplst","frac_bplntst","frac_bplnt","frac_bplst",
"p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
"nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
#for (dep in c("p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
#              "nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
for (thr in c(50,75)) {
for (byr in c(1840,1850,1860,1870,1880)) {
ysnc <- paste0("ysncdecfyrdsplitabove",thr,"perc")
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear==byr & datayear>=byr & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab")) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear",byr,"_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
## 1850-1900 boundaries
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1900,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1900_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1940,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900) |
(boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |  (boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1940_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
}
for (dep in c("dfrac_bplntst","dfrac_bplnt","dfrac_bplst","frac_bplntst","frac_bplnt","frac_bplst",
"p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
"nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
#for (dep in c("p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
#              "nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
for (thr in c(50,75)) {
for (byr in c(1840,1850,1860,1870,1880)) {
ysnc <- paste0("ysncdecfyrdsplitabove",thr,"perc")
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear==byr & datayear>=byr & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab")) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear",byr,"_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
## 1850-1900 boundaries
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1840,1900,10) & ((boundyear==1840 & datayear>=1840) | (boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1840to1900_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
}
##### Event study specification of the effects of splitting
for (dep in c("dfrac_bplntst","dfrac_bplnt","dfrac_bplst","frac_bplntst","frac_bplnt","frac_bplst",
"p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
"nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
#for (dep in c("p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
#              "nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
for (thr in c(50,75)) {
for (byr in c(1850,1860,1870,1880)) {
ysnc <- paste0("ysncdecfyrdsplitabove",thr,"perc")
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear==byr & datayear>=byr & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab")) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear",byr,"_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
## 1850-1900 boundaries
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1900,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1900_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
}
for (dep in c("dfrac_bplntst","dfrac_bplnt","dfrac_bplst","frac_bplntst","frac_bplnt","frac_bplst",
"p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
"nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
#for (dep in c("p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
#              "nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
for (thr in c(50,75)) {
for (byr in c(1840,1850,1860,1870,1880)) {
ysnc <- paste0("ysncdecfyrdsplitabove",thr,"perc")
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear==byr & datayear>=byr & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab")) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear",byr,"_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
## 1850-1900 boundaries
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1900,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1900_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
}
##### Event study specification of the effects of splitting
for (dep in c("dfrac_bplntst","dfrac_bplnt","dfrac_bplst","frac_bplntst","frac_bplnt","frac_bplst",
"p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
"nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
#for (dep in c("p100kpopnind1950_pubadfsl","p100kpopnind1950_pubadfed","p100kpopnind1950_pubadstat","p100kpopnind1950_pubadlocal",
#              "nind1950_pubadfsl","nind1950_pubadfed","nind1950_pubadstat","nind1950_pubadlocal")) {
for (thr in c(50,75)) {
for (byr in c(1840,1850,1860,1870,1880)) {
ysnc <- paste0("ysncdecfyrdsplitabove",thr,"perc")
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear==byr & datayear>=byr & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab")) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate), size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear",byr,"_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
## 1850-1870 boundaries
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1870,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1870_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
## 1850-1900 boundaries
(event_study(data = uscountydiv_analysis_panel %>% filter(boundyear %in% seq(1850,1900,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) | (boundyear==1900 & datayear>=1900)) & (is.na(!!sym(ysnc)) | (!!sym(ysnc) >= -10 & !!sym(ysnc)<=10))),
yname = dep, idname = "boundyear_gisjoin", tname = "decyear", gname = paste0("decfyrdsplitabove",thr,"perc"), estimator = c("sunab"),
xformla=~boundyear) %>%
plot_event_study() %>% .$data %>% ggplot() + geom_point(aes(term, estimate),size=4) + geom_errorbar(aes(x=term, ymin=ci_lower,ymax=ci_upper),size=2) +
geom_hline(yintercept=0, size=0.5) + geom_vline(xintercept=-1, linetype="dashed", size=0.5) + geom_point(aes(-1,0),size=4,color="red")+
scale_x_continuous(breaks=seq(-10,10,1),minor_breaks=NULL)+theme_minimal()+
theme(axis.line = element_line(linewidth = 1)) + labs(x="Decades Since First Split", y="Coefficient")) %>%
ggsave(file=paste0(USCountyDiv, "/results/uscountydiv_effectsofdivision_eventstudy_sunab_FEyearboundyeargisjoin_boundyear1850to1900_dsplitabove",thr,"perc_",dep,".png"),
height=8, width=10)
}
}
######### The equivalent to event study version
a <- feols(c(frac_bplntst,frac_bplst,frac_bplnt) ~ postfyrdsplitabove50perc | boundyear+boundyear_gisjoin+datayear, uscountydiv_analysis_panel %>%
filter(boundyear %in% seq(1850,1880,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870))),cluster="nhgisst")
uscountydiv_analysis_panel <- uscountydiv_analysis_panel %>% mutate(
across(matches("^fyrdsplitabove") & !matches("dec"), ~ ifelse(. <= datayear | is.na(.),0,1), .names = "post{col}"))
a <- feols(c(frac_bplntst,frac_bplst,frac_bplnt) ~ postfyrdsplitabove50perc | boundyear+boundyear_gisjoin+datayear, uscountydiv_analysis_panel %>%
filter(boundyear %in% seq(1850,1880,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870))),cluster="nhgisst")
b <- feols(c(frac_bplntst,frac_bplst,frac_bplnt) ~ postfyrdsplitabove75perc | boundyear+boundyear_gisjoin+datayear, uscountydiv_analysis_panel %>%
filter(boundyear %in% seq(1850,1880,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870))),cluster="nhgisst")
etable(a,b,replace= TRUE, keep = c("Post-Split"), digits="r3",depvar = FALSE,
headers = .(" " = .('Birthplace Fractionalization (Level)'=6),
" " = .("State or Country"=1,"State"=1,"Country"=1,"State or Country"=1,"State"=1,"Country"=1)),
file = paste0(USCountyDiv, "/results/uscountydiv_reg_division_diversity_nextdecade_multiplethreshold_cpp_frac_bpl_boundyear1850to1870_TWFE_FEboundyearXboundyeargisjoinXdatayear_CLnhgisst_merged5075.tex"))
setFixest_etable(reset=TRUE, style.tex = style.tex("qje", model.title ="", stats.title = " ", yesNo = c("$\\checkmark$", " "), fixef.suffix = " FEs", fixef.where = "var"),
depvar = TRUE, fitstat = ~ my + n, digits = "r3")
setFixest_dict(c(n = "N",my="Mean of Dep Var",gisjoin="County",icpsrfipst="State",nhgisst="State/Territory",gridid400km="Grid (400km)",gridid500km="Grid (500km)", datayear="Year", year="Year",
boundyear="Boundary Year", boundyear_gisjoin ="BoundaryYearCounty",
frac_bplst="Fractionalization: State", frac_bplnt="Fractionalization: Country",frac_bplntst="Fractionalization: State or Country",
polar_bplst="Fractionalization: State", polar_bplnt="Fractionalization: Country",polar_bplntst="Fractionalization: State or Country",
shfrb="% Foreign Born", shwhpop="% White", lnpop="Log Population", lareasqmi="Log County Area",
ldistfront="Log Dist to Frontier", ldistfort="Log Dist to Forts", ldistrail="Log Dist to Railroad", ldiststeam="Log Dist to Steam", ldistcanal="Log Dist to Canal",
ldistpost="Log Dist to Post Office", ldistseat="Log Dist to County Seat", ldistcourt="Log Dist to County Court",
ldistlake="Log Dist to Lake",ldistriver="Log Dist to River",ldistcoast="Log Dist to Coast", ldistportage="Log Dist to Portage", ldistfallline="Log Dist to Fall Line",
lnind1950_educ="Log Emp in Education", lnind1950_pubadpost="Log Public Admin Emp: Post Office",
lnind1950_pubadfed="Log Public Admin Emp: Federal Gov",lnind1950_pubadstat="Log Public Admin Emp: State Gov",
lnind1950_pubadlocal="Log Public Admin Emp: Local Gov",
dsplitabove5perc="Subdivided (5% Threshold)",dsplitabove10perc="Subdivided (10% Threshold)",dsplitabove25perc="Subdivided (25% Threshold)",
dsplitabove50perc="Subdivided (50% Threshold)",dsplitabove75perc="Subdivided (75% Threshold)",dsplitabove99perc="Subdivided (99% Threshold)",
dsplitabove5perc_nexdec="Subdivided (5% Threshold)",dsplitabove10perc_nexdec="Subdivided (10% Threshold)",dsplitabove25perc_nexdec="Subdivided (25% Threshold)",
dsplitabove50perc_nexdec="Subdivided (50% Threshold)",dsplitabove75perc_nexdec="Subdivided (75% Threshold)",dsplitabove99perc_nexdec="Subdivided (99% Threshold)"),
postfyrdsplitabove5perc = "Post-Split (5%)", postfyrdsplitabove25perc = "Post-Split (25%)", postfyrdsplitabove50perc = "Post-Split (50%)", postfyrdsplitabove75perc = "Post-Split (75%)")
a <- feols(c(frac_bplntst,frac_bplst,frac_bplnt) ~ postfyrdsplitabove50perc | boundyear+boundyear_gisjoin+datayear, uscountydiv_analysis_panel %>%
filter(boundyear %in% seq(1850,1880,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870))),cluster="nhgisst")
b <- feols(c(frac_bplntst,frac_bplst,frac_bplnt) ~ postfyrdsplitabove75perc | boundyear+boundyear_gisjoin+datayear, uscountydiv_analysis_panel %>%
filter(boundyear %in% seq(1850,1880,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870))),cluster="nhgisst")
etable(a,b,replace= TRUE, keep = c("Post-Split"), digits="r3",depvar = FALSE,
headers = .(" " = .('Birthplace Fractionalization (Level)'=6),
" " = .("State or Country"=1,"State"=1,"Country"=1,"State or Country"=1,"State"=1,"Country"=1)),
file = paste0(USCountyDiv, "/results/uscountydiv_reg_division_diversity_nextdecade_multiplethreshold_cpp_frac_bpl_boundyear1850to1870_TWFE_FEboundyearXboundyeargisjoinXdatayear_CLnhgisst_merged5075.tex"))
a <- feols(c(dfrac_bplntst,dfrac_bplst,dfrac_bplnt) ~ postfyrdsplitabove50perc | boundyear+boundyear_gisjoin+datayear, uscountydiv_analysis_panel %>%
filter(boundyear %in% seq(1850,1880,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) |
(boundyear==1900 & datayear>=1900) | (boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |
(boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940))),cluster="nhgisst")
b <- feols(c(dfrac_bplntst,dfrac_bplst,dfrac_bplnt) ~ postfyrdsplitabove75perc | boundyear+boundyear_gisjoin+datayear, uscountydiv_analysis_panel %>%
filter(boundyear %in% seq(1850,1880,10) & ((boundyear==1850 & datayear>=1850) | (boundyear==1860 & datayear>=1860) |
(boundyear==1870 & datayear>=1870) | (boundyear==1880 & datayear>=1880) | (boundyear==1890 & datayear>=1890) |
(boundyear==1900 & datayear>=1900) | (boundyear==1910 & datayear>=1910) | (boundyear==1920 & datayear>=1920) |
(boundyear==1930 & datayear>=1930) | (boundyear==1940 & datayear>=1940))),cluster="nhgisst")
etable(a,b,replace= TRUE, keep = c("Post-Split"), digits="r3",depvar = FALSE,
headers = .(" " = .('Birthplace Fractionalization (Level)'=6),
" " = .("State or Country"=1,"State"=1,"Country"=1,"State or Country"=1,"State"=1,"Country"=1)),
file = paste0(USCountyDiv, "/results/uscountydiv_reg_division_diversity_nextdecade_multiplethreshold_cpp_dfrac_bpl_boundyear1850to1940_TWFE_FEboundyearXboundyeargisjoinXdatayear_CLnhgisst_merged5075.tex"))
etable(a,b,replace= TRUE, keep = c("Post-Split"), digits="r3",depvar = FALSE,
headers = .(" " = .('Difference in Birthplace Fractionalization Following Split (Children vs Parent)'=6),
" " = .("State or Country"=1,"State"=1,"Country"=1,"State or Country"=1,"State"=1,"Country"=1)),
file = paste0(USCountyDiv, "/results/uscountydiv_reg_division_diversity_nextdecade_multiplethreshold_cpp_dfrac_bpl_boundyear1850to1940_TWFE_FEboundyearXboundyeargisjoinXdatayear_CLnhgisst_merged5075.tex"))
pacman::p_load(tidyverse,dtplyr,arrow,sf,ggplot2, haven,mapview,tmap, tmaptools, panelsummary,purrr, data.table, fixest,gtools,magick, janitor, panelr,
terra,labelled, MODIStsp,readxl,rvest,RSelenium,netstat,geodata, stringdist,raster,luna,lubridate,zonator, exactextractr,stars, tmap, janitor, data.table, ncdf4,utils, fs, fixest, tictoc, collapse, ncdf4,pdftools)
select <- dplyr::select
tmap_mode("view")
tmap_options(check.and.fix = TRUE)
Dropbox <- "/Users/mgebresilasse/Dropbox (Personal)"
DropboxAmherst <- "/Users/mgebresilasse/Dropbox (Amherst College)"
#Dropbox <- "D:/Dropbox (Personal)"
#DropboxAmherst <- "D:/Dropbox (Amherst College)"
EthioRepo <- paste0(Dropbox, "/EthioRepo")
USRepo <- paste0(Dropbox, "/USRepo")
IPUMS <- "D:/Dropbox (Personal)/USCountyCourtsDevelopment/data/IPUMS"
options(scipen=999)
uscountyshp17902010 <- readRDS(paste0(USRepo, "/cleaned/uscountyshp17902010.rds"))
uscountrycontinental <- readRDS(paste0(USRepo, "/cleaned/uscountrycontinental.rds"))
uscountrycontinental_buff <- st_buffer(uscountrycontinental, -1)
tm_shape(uscountrycontinental) + tm_borders() + tm_shape(uscountrycontinental_buff) + tm_borders("red")
pacman::p_load(tidyverse,dtplyr,arrow,sf,ggplot2, haven,mapview,tmap, tmaptools, panelsummary,purrr, data.table, fixest,gtools,magick, janitor, panelr,
terra,labelled, MODIStsp,readxl,rvest,RSelenium,netstat,geodata, stringdist,raster,luna,lubridate,zonator, exactextractr,stars, tmap, janitor, data.table, ncdf4,utils, fs, fixest, tictoc, collapse, ncdf4,pdftools)
select <- dplyr::select
tmap_mode("view")
tmap_options(check.and.fix = TRUE)
Dropbox <- "/Users/mgebresilasse/Dropbox (Personal)"
DropboxAmherst <- "/Users/mgebresilasse/Dropbox (Amherst College)"
#Dropbox <- "D:/Dropbox (Personal)"
#DropboxAmherst <- "D:/Dropbox (Amherst College)"
EthioRepo <- paste0(Dropbox, "/EthioRepo")
USRepo <- paste0(Dropbox, "/USRepo")
IPUMS <- "D:/Dropbox (Personal)/USCountyCourtsDevelopment/data/IPUMS"
options(scipen=999)
uscountyshp17902010 <- readRDS(paste0(USRepo, "/cleaned/uscountyshp17902010.rds"))
uscountrycontinental <- readRDS(paste0(USRepo, "/cleaned/uscountrycontinental.rds"))
uscountrycontinental
uscountrycontinental_buff1m <- st_buffer(uscountrycontinental, -1)
saveRDS(uscountrycontinental_buff1m,paste0(USRepo, "/cleaned/uscountrycontinental_buff1m,rds"))
saveRDS(uscountrycontinental_buff1m,paste0(USRepo, "/cleaned/uscountrycontinental_buff1m.rds"))
tm_shape(uscountrycontinental_buff1m) + tm_borders("red") + tm_shape(uscountrycontinental)+tm_borders()
pacman::p_load(tidyverse,dtplyr,arrow,sf,ggplot2, haven,mapview,tmap, tmaptools, panelsummary,purrr, data.table, fixest,gtools,magick, janitor, panelr,
terra,labelled, MODIStsp,readxl,rvest,RSelenium,netstat,geodata, stringdist,raster,luna,lubridate,zonator, exactextractr,stars, tmap, janitor, data.table, ncdf4,utils, fs, fixest, tictoc, collapse, ncdf4,pdftools)
select <- dplyr::select
tmap_mode("view")
tmap_options(check.and.fix = TRUE)
Dropbox <- "/Users/mgebresilasse/Dropbox (Personal)"
DropboxAmherst <- "/Users/mgebresilasse/Dropbox (Amherst College)"
#Dropbox <- "D:/Dropbox (Personal)"
#DropboxAmherst <- "D:/Dropbox (Amherst College)"
EthioRepo <- paste0(Dropbox, "/EthioRepo")
USRepo <- paste0(Dropbox, "/USRepo")
IPUMS <- "D:/Dropbox (Personal)/USCountyCourtsDevelopment/data/IPUMS"
options(scipen=999)
uscountyshp17902010 <- readRDS(paste0(USRepo, "/cleaned/uscountyshp17902010.rds"))
settlement_stack <- readRDS(paste0(USRepo, "/cleaned/zillow_historical_settlement_stack.rds"))
settlement_stack <- readRDS(paste0(USRepo, "/cleaned/zillow_historical_settlement_stack.rds"))
rm(uscountyshp17902010)
settlement_stack <- readRDS(paste0(USRepo, "/cleaned/zillow_historical_settlement_stack.rds"))
settlement_stack <- readRDS(paste0(USRepo, "/cleaned/zillow_historical_settlement_stack.rds"))
pacman::p_load(tidyverse,dtplyr,arrow,sf,ggplot2, haven,mapview,tmap, tmaptools, panelsummary,purrr, data.table, fixest,gtools,magick, janitor, panelr,
terra,labelled, MODIStsp,readxl,rvest,RSelenium,netstat,geodata, stringdist,raster,luna,lubridate,zonator, exactextractr,stars, tmap, janitor, data.table, ncdf4,utils, fs, fixest, tictoc, collapse, ncdf4,pdftools)
select <- dplyr::select
tmap_mode("view")
tmap_options(check.and.fix = TRUE)
Dropbox <- "/Users/mgebresilasse/Dropbox (Personal)"
DropboxAmherst <- "/Users/mgebresilasse/Dropbox (Amherst College)"
#Dropbox <- "D:/Dropbox (Personal)"
#DropboxAmherst <- "D:/Dropbox (Amherst College)"
EthioRepo <- paste0(Dropbox, "/EthioRepo")
USRepo <- paste0(Dropbox, "/USRepo")
IPUMS <- "D:/Dropbox (Personal)/USCountyCourtsDevelopment/data/IPUMS"
options(scipen=999)
uscountyshp17902010_settlement <- readRDS(paste0(USRepo, "/cleaned/uscountyshp17902010_settlement_list.rds"))
uscountyshp17902010_settlement2 <- uscountyshp17902010_settlement %>%  reduce(bind_rows) %>% select(-sum.FBUY)
View(uscountyshp17902010_settlement2)
uscountyshp17902010_settlement2 %>% ggplot() + geom_bar(aes(boundyear.x))
uscountyshp17902010_settlement2 <- uscountyshp17902010_settlement %>%  reduce(bind_rows) %>% select(-sum.FBUY) %>%
#mutate(across(starts_with("sum") | starts_with("min"), as.integer)) %>%
pivot_longer(-c("gisjoin","boundyear"), names_to = c('.value', 'year'), names_pattern = '(.*?)(\\d+)') %>%
clean_names() %>% filter(!is.na(year))  %>% rename(nsumbua=sum_bua,nsumbupl=sum_bupl,nsumbupr=sum_bupr) %>%
left_join(exact_extract(settlement_stack$FBUY, uscountyshp17902010_s, c('min'), append_cols = c("gisjoin","boundyear")) %>% rename(fbuyear = min), by = c("gisjoin","boundyear"))
uscountyshp17902010_settlement2 <- uscountyshp17902010_settlement %>%  reduce(bind_rows) %>% select(-sum.FBUY) %>%
rename(boundyear=boundyear.x) %>%
#mutate(across(starts_with("sum") | starts_with("min"), as.integer)) %>%
pivot_longer(-c("gisjoin","boundyear"), names_to = c('.value', 'year'), names_pattern = '(.*?)(\\d+)') %>%
clean_names() %>% filter(!is.na(year))  %>% rename(nsumbua=sum_bua,nsumbupl=sum_bupl,nsumbupr=sum_bupr) %>%
left_join(exact_extract(settlement_stack$FBUY, uscountyshp17902010_s, c('min'), append_cols = c("gisjoin","boundyear")) %>% rename(fbuyear = min), by = c("gisjoin","boundyear"))
uscountyshp17902010_settlement2 <- uscountyshp17902010_settlement %>%  reduce(bind_rows) %>% select(-sum.FBUY) %>%
rename(boundyear=boundyear.x) %>%
#mutate(across(starts_with("sum") | starts_with("min"), as.integer)) %>%
pivot_longer(-c("gisjoin","boundyear"), names_to = c('.value', 'year'), names_pattern = '(.*?)(\\d+)') %>%
clean_names() %>% filter(!is.na(year))  %>% rename(nsumbua=sum_bua,nsumbupl=sum_bupl,nsumbupr=sum_bupr)
View(uscountyshp17902010_settlement2)
uscountyshp17902010_settlement2 <- uscountyshp17902010_settlement %>%  reduce(bind_rows) %>% select(-sum.FBUY) %>%
rename(boundyear=boundyear.x,fbuyear=min) %>%
#mutate(across(starts_with("sum") | starts_with("min"), as.integer)) %>%
pivot_longer(-c("gisjoin","boundyear",), names_to = c('.value', 'year'), names_pattern = '(.*?)(\\d+)') %>%
clean_names() %>% filter(!is.na(year))  %>% rename(nsumbua=sum_bua,nsumbupl=sum_bupl,nsumbupr=sum_bupr)
View(uscountyshp17902010_settlement2)
uscountyshp17902010_settlement <- readRDS(paste0(USRepo, "/cleaned/uscountyshp17902010_settlement_list.rds"))
uscountyshp17902010_settlement2 <- uscountyshp17902010_settlement %>%  reduce(bind_rows) %>% select(-sum.FBUY) %>%
pivot_longer(-c("gisjoin","boundyear"), names_to = c('.value', 'year'), names_pattern = '(.*?)(\\d+)') %>%
clean_names() %>% filter(!is.na(year))  %>% rename(nsumbua=sum_bua,nsumbupl=sum_bupl,nsumbupr=sum_bupr) %>%
left_join(exact_extract(subset(settlement_stack, grep('FBUY', names(settlement_stack), value = T)), uscountyshp17902010_select, c('min'), append_cols = c("gisjoin","boundyear")) %>%
select(gisjoin,boundyear,fbuyear=min.FBUY), by = c("gisjoin","boundyear"))
uscountyshp17902010_settlement2 <- uscountyshp17902010_settlement %>%  reduce(bind_rows) %>% select(-sum.FBUY) %>%
pivot_longer(-c("gisjoin","boundyear"), names_to = c('.value', 'year'), names_pattern = '(.*?)(\\d+)') %>%
clean_names() %>% filter(!is.na(year))  %>% rename(nsumbua=sum_bua,nsumbupl=sum_bupl,nsumbupr=sum_bupr)
View(uscountyshp17902010_settlement2)
uscountyshp17902010_settlement2 %>% filter(gisjoin=="G0900010") %>% tm_shape() + tm_line("nsumbua")
uscountyshp17902010_settlement2 %>% filter(gisjoin=="G0900010") %>% ggplot() + geom_line("nsumbua")
uscountyshp17902010_settlement2 %>% filter(gisjoin=="G0900010") %>% ggplot() + geom_line(aes("nsumbua"))
uscountyshp17902010_settlement2 %>% filter(gisjoin=="G0900010") %>% ggplot() + geom_line(aes("nsumbua"))
uscountyshp17902010_settlement2 %>% filter(gisjoin=="G0900010") %>% ggplot() + geom_line(aes(year,nsumbua))
uscountyshp17902010_settlement2 %>% filter(gisjoin=="G0900010") %>% ggplot() + geom_line(aes(year,nsumbua,group=gisjoin))
uscountyshp17902010_settlement2 %>% filter(str_detect(gisjoin,"G09")) %>% ggplot() + geom_line(aes(year,nsumbua,group=gisjoin))
uscountyshp17902010 <- readRDS(paste0(USRepo, "/cleaned/uscountyshp17902010.rds"))
uscountyshp17902010_data <- uscountyshp17902010 %>% filter(boundyear==1790) %>% full_join(uscountyshp17902010_settlement2 %>% filter(year<1820),by=c("gisjoin","boundyear"))
uscountyshp17902010_data %>% filter(year==1810) %>% tm_shape() + tm_borders("nsumbua")
uscountyshp17902010_data %>% filter(year==1810) %>% tm_shape() + tm_fill("nsumbua")
uscountyshp17902010_data <- uscountyshp17902010_data %>% select(gisjoin,boundyear,year,nsumbua)
uscountyshp17902010_data <- uscountyshp17902010_data %>% mutate(pareanusmbua= nsumbua/as.numeric(st_area(.)))
uscountyshp17902010_data %>% filter(year==1810) %>% tm_shape() + tm_fill("pareanusmbua")
pacman::p_load(tidyverse,sf,tmap)
setwd("/Users/mgebresilasse/Dropbox (Amherst College)/Courses/202324_Spring/Econ429/Lab/lab1")
setwd("/Users/mgebresilasse/Dropbox (Amherst College)/Courses/202324_Spring/Econ429/Lab/lab1")
#
ethiopia_woredas <-  st_read("eth_admbnda_adm3_csa_bofedb_2021.shp")
View(ethiopia_woredas)
ethiopia_zones <-  st_read("eth_admbnda_adm2_csa_bofedb_2021.shp")
View(ethiopia_zones)
ethpop_zone_2022 <- read_csv("ethiopia_population_zone_2022.csv")
write_csv(ethpop_zone_2022, "ethiopia_population_zone_2022_new.csv")
saveRDS(ethpop_zone_2022, "ethiopia_population_zone_2022.rds")
popunder4 <- read_xlsx("ethiopia_populationunder4_zone_2022.xlsx")
?read_xlsx
?tmap
?saveRDS
popunder4 <- read_xlsx("ethiopia_populationunder4_zone_2022.xlsx")
pacman::p_load(tidyverse,sf,tmap,readxl)
popunder4 <- read_xlsx("ethiopia_populationunder4_zone_2022.xlsx")
View(popunder4)
ethpop_popzone_2022 <- read_csv("ethiopia_population_zone_2022.csv")
View(popunder4)
View(ethpop_popzone_2022)
ethpop_popzone_2022_new <- ethpop_popzone_2022 %>%
left_join(popunder4,by=c("admin2Pcode"))
View(ethpop_popzone_2022_new)
ethpop_popzone_2022 <- read_csv("ethiopia_population_zone_2022.csv")
saveRDS(ethpop_zone_2022, "ethiopia_population_zone_2022.rds")
saveRDS(ethpop_zone_2022, "ethiopia_population_zone_2022_new.rds")
ethpop_zone_2022_operated <- ethpop_zone_2022_new %>%
select(admin2Name,admin2Pcode,pop)
View(ethiopia_zones)
View(ethpop_popzone_2022)
ethpop_zone_2022_operated <- ethpop_zone_2022 %>%
select(admin2Name,admin2Pcode,pop_total, pop_female,pop_female)
View(ethpop_popzone_2022)
ethpop_zone_2022_operated <- ethpop_zone_2022 %>%
select(admin2Name_en,admin2Pcode,pop_total,pop_female,pop_female) %>%
rename(zone_name=admin2Name_en,zone_code=admin2Pcode)
View(ethpop_zone_2022)
ethpop_popzone_2022 <- read_csv("ethiopia_population_zone_2022.csv")
View(ethpop_popzone_2022)
